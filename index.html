<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NYEZ.ID - Premium Customer Experience</title>
    
    <!-- Perpustakaan Eksternal -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #8e44ad;
            --primary-dark: #6c3483;
            --primary-light: #a569bd;
            --bg: #F5F0FF; 
            --text-main: #2d134d;
            --text-muted: #7d669e;
            --white: #ffffff;
            --sidebar-width: 280px;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --radius-xl: 32px;
            --radius-lg: 24px;
            --shadow-sm: 0 4px 6px -1px rgba(142, 68, 173, 0.05);
            --shadow-md: 0 10px 15px -3px rgba(142, 68, 173, 0.08);
            --shadow-lg: 0 20px 25px -5px rgba(142, 68, 173, 0.12);
            --spring: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Gaya Dasar */
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: var(--text-main); 
            display: flex; 
            min-height: 100vh; 
            overflow-x: hidden; 
        }

        /* --- LOADING SCREEN --- */
        #app-preloader {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1a0b2e, #2d134d);
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.8s;
        }

        .preloader-logo {
            font-size: 4rem;
            color: var(--white);
            margin-bottom: 24px;
            animation: pulse-gem 2s infinite ease-in-out;
            filter: drop-shadow(0 0 15px rgba(165, 105, 189, 0.5));
        }

        .preloader-text {
            color: white;
            font-weight: 800;
            letter-spacing: 4px;
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        .loading-bar-container {
            width: 150px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .loading-bar-fill {
            position: absolute;
            height: 100%;
            width: 50%;
            background: var(--primary-light);
            border-radius: 10px;
            animation: loading-slide 1.5s infinite ease-in-out;
        }

        @keyframes pulse-gem {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        @keyframes loading-slide {
            0% { left: -50%; }
            100% { left: 100%; }
        }

        #app-preloader.fade-out {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* --- DEKORASI LATAR BELAKANG --- */
        .bg-decorations {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.6;
            animation: move-organic 30s infinite alternate;
        }
        .blob-1 { width: 700px; height: 700px; background: rgba(165, 105, 189, 0.3); top: -200px; left: -100px; }
        .blob-2 { width: 600px; height: 600px; background: rgba(108, 52, 131, 0.2); bottom: -100px; right: -50px; animation-delay: -7s; }

        @keyframes move-organic {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); }
            33% { transform: translate(100px, 50px) scale(1.1) rotate(10deg); }
            66% { transform: translate(-50px, 120px) scale(0.9) rotate(-15deg); }
            100% { transform: translate(0, 0) scale(1) rotate(0deg); }
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background: #1a0b2e; 
            padding: 48px 24px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: 0.4s var(--spring);
            box-shadow: 10px 0 30px rgba(0,0,0,0.1);
        }

        .sidebar-logo { 
            font-size: 2rem; 
            font-weight: 800; 
            color: var(--white); 
            margin-bottom: 64px; 
            display: flex; 
            align-items: center; 
            gap: 14px;
            letter-spacing: -1.5px;
        }
        .sidebar-logo i { color: var(--primary-light); }

        .nav-group { display: flex; flex-direction: column; gap: 12px; }
        
        .nav-btn {
            background: transparent; border: none; color: #a594c2; padding: 16px 20px;
            text-align: left; border-radius: 20px; cursor: pointer; font-weight: 700;
            display: flex; align-items: center; gap: 16px; width: 100%;
            transition: 0.3s var(--spring);
            font-size: 0.95rem;
        }
        .nav-btn i { font-size: 1.3rem; width: 28px; text-align: center; opacity: 0.8; }
        .nav-btn:hover { color: white; background: rgba(255,255,255,0.06); transform: translateX(5px); }
        .nav-btn.active { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; 
            box-shadow: 0 12px 24px -8px rgba(142, 68, 173, 0.5); 
        }

        /* --- MOBILE IDENTITY --- */
        .mobile-brand-identity {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 10px 0;
            animation: fadeInDown 0.8s var(--spring);
        }
        .brand-logo-wrapper {
            width: 40px;
            height: 40px;
            background: #1a0b2e;
            color: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow-md);
        }
        .mobile-brand-identity span {
            font-size: 1.4rem;
            font-weight: 900;
            letter-spacing: -1.2px;
            color: #1a0b2e;
        }

        /* --- BOTTOM NAV (MOBILE) --- */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 15px; left: 15px; right: 15px;
            background: rgba(26, 11, 46, 0.95);
            backdrop-filter: blur(15px);
            height: 70px;
            z-index: 2000;
            padding: 0 10px;
            justify-content: space-around;
            align-items: center;
            border-radius: 24px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s var(--spring);
        }

        .mobile-nav-btn {
            background: transparent; border: none;
            color: rgba(255,255,255,0.5);
            display: flex; flex-direction: column;
            align-items: center; gap: 4px;
            font-size: 0.65rem; font-weight: 800;
            transition: 0.4s var(--spring);
            flex: 1;
            position: relative;
        }
        .mobile-nav-btn i { font-size: 1.3rem; }
        .mobile-nav-btn.active { color: white; transform: translateY(-5px); }
        .mobile-nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -10px;
            width: 5px;
            height: 5px;
            background: var(--primary-light);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-light);
        }

        /* --- KONTEN UTAMA --- */
        .main-content { 
            flex-grow: 1;
            margin-left: var(--sidebar-width); 
            padding: 64px 56px; 
            width: calc(100% - var(--sidebar-width)); 
            max-width: 1600px;
            position: relative;
        }

        .tab-content {
            animation: tabFade 0.5s var(--spring);
        }

        @keyframes tabFade {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 40px;
        }
        header h2 { font-size: 2.6rem; font-weight: 800; letter-spacing: -2px; color: var(--text-main); }
        header p { font-size: 1.1rem; color: var(--text-muted); font-weight: 500; margin-top: 6px; }

        /* --- FLOATING SYNC STATUS --- */
        #sync-status {
            position: fixed;
            top: 30px;
            right: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px; 
            border-radius: 50px; 
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(142, 68, 173, 0.15);
            box-shadow: 0 10px 25px -5px rgba(142, 68, 173, 0.1);
            font-size: 0.7rem; 
            font-weight: 800;
            letter-spacing: 1px; 
            color: var(--primary);
            z-index: 5000;
            transition: 0.4s var(--spring);
        }
        #sync-status i {
            font-size: 0.9rem;
            animation: spin-pulse 3s infinite linear;
        }
        @keyframes spin-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* --- SEARCH SECTION --- */
        .search-container {
            margin-bottom: 32px;
            position: relative;
            width: 100%; 
            max-width: 100%; 
        }
        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .search-input-wrapper i {
            position: absolute;
            left: 24px;
            color: var(--primary);
            font-size: 1.2rem;
            z-index: 2;
        }
        .menu-search-input {
            width: 100%;
            padding: 18px 24px 18px 60px;
            border-radius: 20px;
            border: 2px solid transparent;
            background: white;
            box-shadow: var(--shadow-sm);
            outline: none;
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-main);
            transition: 0.4s var(--spring);
        }
        .menu-search-input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 8px 20px rgba(142, 68, 173, 0.1);
            transform: scale(1.01);
        }

        /* --- CATEGORY PILLS --- */
        .category-container {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            overflow-x: auto;
            padding: 4px 0;
            scrollbar-width: none;
        }
        .cat-card {
            background: var(--white);
            padding: 10px 24px;
            border-radius: 16px;
            font-weight: 800;
            font-size: 0.8rem;
            color: var(--text-muted);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: 0.3s var(--spring);
            border: 2.5px solid transparent;
            white-space: nowrap;
        }
        .cat-card:hover { transform: translateY(-3px); color: var(--primary); }
        .cat-card.active {
            background: #2d134d;
            color: white;
            border-color: #2d134d;
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(45, 19, 77, 0.2);
        }

        /* --- PRODUCT GRID --- */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 70px 24px; 
            padding-top: 40px;
            margin-bottom: 50px;
        }

        .product-card {
            background: var(--white);
            border-radius: 28px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 2.5px solid transparent;
            transition: all 0.5s var(--spring);
            display: flex; 
            flex-direction: column; 
            align-items: center;
            cursor: pointer;
            position: relative;
            opacity: 0;
            animation: cardAppear 0.6s var(--spring) forwards;
        }

        @keyframes cardAppear {
            from { opacity: 0; transform: translateY(30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .product-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 30px 60px -12px rgba(142, 68, 173, 0.15); 
            border-color: var(--primary-light);
            z-index: 10;
        }

        .img-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            margin-top: -70px; 
            margin-bottom: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .img-accent {
            position: absolute;
            width: 90%;
            height: 90%;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            border-radius: 24px;
            opacity: 0.1;
            transition: 0.8s var(--spring);
        }

        .product-img {
            width: 90%;
            height: 90%;
            border-radius: 24px;
            object-fit: cover;
            transition: all 0.6s var(--spring);
            z-index: 2;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .product-info {
            width: 100%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .product-card h4 { font-weight: 800; font-size: 1.1rem; color: var(--text-main); transition: 0.3s; letter-spacing: -0.4px; }
        .product-card .price { font-weight: 900; color: var(--primary); font-size: 1.3rem; margin: 8px 0; display: block; }

        /* Premium Tambah Button */
        .btn-add-small {
            width: 100%;
            padding: 14px;
            border-radius: 18px;
            border: none;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            font-weight: 800;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.4s var(--spring);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 15px -5px rgba(142, 68, 173, 0.4);
        }

        .product-card:hover .btn-add-small { transform: scale(1.05); box-shadow: 0 12px 20px -5px rgba(142, 68, 173, 0.5); }

        /* --- AESTHETIC REVIEW (CART FLOAT) BUTTON --- */
        .cart-float {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: linear-gradient(135deg, #1a0b2e, #2d134d);
            backdrop-filter: blur(15px);
            color: white;
            padding: 14px 28px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 15px 35px -5px rgba(26, 11, 46, 0.5);
            cursor: pointer;
            z-index: 1001;
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.5s var(--spring);
        }

        .cart-badge {
            background: var(--primary-light);
            color: white;
            width: 26px; height: 26px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.8rem;
            box-shadow: 0 0 15px rgba(165, 105, 189, 0.4);
        }

        .cart-label { display: flex; flex-direction: column; gap: 2px; }
        .cart-label span:first-child { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.7; }
        .cart-label span:last-child { font-size: 1.05rem; font-weight: 900; letter-spacing: -0.5px; }

        /* --- MODALS --- */
        .modal-overlay { 
            position: fixed; inset: 0;
            background: rgba(26, 11, 46, 0.4); 
            backdrop-filter: blur(8px); 
            z-index: 9999; 
            display: flex; align-items: center; justify-content: center; 
            padding: 20px;
            animation: modalFadeIn 0.4s ease;
        }
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-card { 
            background: white; 
            width: 100%; max-width: 550px; 
            border-radius: 35px; 
            padding: 0; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.2); 
            max-height: 90vh; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalSlideUp 0.6s var(--spring);
            position: relative;
        }
        @keyframes modalSlideUp { 
            from { transform: translateY(100%) scale(0.9); opacity: 0; } 
            to { transform: translateY(0) scale(1); opacity: 1; } 
        }

        .close-modal-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: #f1f5f9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            cursor: pointer;
            z-index: 100;
            transition: 0.3s var(--spring);
        }
        .close-modal-btn:hover {
            background: #fee2e2;
            color: #ef4444;
            transform: rotate(90deg) scale(1.1);
        }

        .modal-body { padding: 32px; overflow-y: auto; flex-grow: 1; }
        .modal-footer { padding: 24px 32px; background: #f8fafc; border-top: 1px solid #f1f5f9; }

        /* --- TOPPING UI UPGRADE --- */
        .topping-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin-top: 20px; 
        }
        .topping-item { 
            position: relative; 
            padding: 16px; 
            border-radius: 20px; 
            border: 2px solid #f1f5f9; 
            background: #ffffff; 
            text-align: left; 
            cursor: pointer; 
            transition: 0.4s var(--spring); 
            display: flex; 
            flex-direction: column; 
            gap: 4px;
        }
        .topping-item.selected { 
            border-color: var(--primary); 
            background: #f5f3ff; 
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.1);
        }
        .topping-item .top-name { font-weight: 800; font-size: 0.95rem; color: var(--text-main); }
        .topping-item .top-price { font-weight: 700; font-size: 0.75rem; color: var(--primary); background: rgba(142, 68, 173, 0.08); width: fit-content; padding: 2px 8px; border-radius: 8px; }
        .topping-item .top-check { position: absolute; top: 12px; right: 12px; width: 22px; height: 22px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; opacity: 0; transform: scale(0.4) rotate(-45deg); transition: 0.4s var(--spring); }
        .topping-item.selected .top-check { opacity: 1; transform: scale(1) rotate(0); }

        .qty-ctrl { display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 32px; background: #f1f5f9; padding: 10px; border-radius: 20px; width: fit-content; margin-left: auto; margin-right: auto; }
        .qty-btn { width: 44px; height: 44px; border-radius: 16px; border: none; background: white; color: var(--text-main); font-size: 1.2rem; font-weight: 800; cursor: pointer; box-shadow: var(--shadow-sm); transition: 0.3s var(--spring); }

        /* --- CHECKOUT SPECIFIC UI --- */
        .checkout-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: #f8fafc;
            border-radius: 20px;
            margin-bottom: 12px;
            border: 1px solid #f1f5f9;
            transition: 0.3s;
        }
        .checkout-item:hover { border-color: var(--primary-light); background: #ffffff; box-shadow: var(--shadow-sm); }
        .checkout-item-title { font-weight: 800; color: var(--text-main); font-size: 1rem; }
        .checkout-item-toppings { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }
        .checkout-item-price { font-weight: 900; color: var(--primary); }

        .payment-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .payment-option { 
            padding: 20px 10px; 
            border-radius: 20px; 
            border: 2px solid #f1f5f9; 
            background: #f8fafc; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 10px; 
            cursor: pointer; 
            transition: 0.4s var(--spring); 
            font-weight: 800; 
            color: var(--text-muted); 
        }
        .payment-option i { font-size: 1.6rem; transition: 0.3s; }
        .payment-option.active { border-color: var(--primary); background: #f5f3ff; color: var(--primary); box-shadow: 0 8px 15px rgba(142, 68, 173, 0.1); }
        .payment-option.active i { transform: scale(1.2); }

        .btn-confirm { 
            width: 100%; 
            padding: 20px; 
            border-radius: 22px; 
            border: none; 
            background: linear-gradient(135deg, #1a0b2e, #2d134d); 
            color: white; 
            font-weight: 800; 
            font-size: 1.1rem; 
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 12px;
            transition: 0.4s var(--spring); 
            box-shadow: 0 10px 20px rgba(26, 11, 46, 0.3);
        }
        .btn-confirm:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(26, 11, 46, 0.4); filter: brightness(1.2); }

        /* Helper Classes */
        .hidden { display: none !important; }
        
        .track-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .track-card { background: white; border-radius: var(--radius-xl); padding: 24px; box-shadow: var(--shadow-md); border-left: 6px solid var(--primary); transition: 0.4s var(--spring); opacity: 0; animation: cardAppear 0.5s var(--spring) forwards; }
        .order-tag { font-family: 'Monaco', monospace; font-weight: 800; color: var(--primary); background: #f5f3ff; padding: 4px 10px; border-radius: 8px; font-size: 0.8rem; }
        .badge { padding: 6px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-pending { background: #fff7ed; color: #9a3412; }
        .badge-ready { background: #ecfdf5; color: #065f46; animation: soft-pulse 2s infinite; }

        @keyframes soft-pulse { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.2); } 70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .bottom-nav { display: flex; }
            .main-content { margin-left: 0; width: 100%; padding: 24px 20px 110px; }
            header h2 { font-size: 1.8rem; }
            #sync-status { top: 20px; right: 20px; padding: 8px 14px; font-size: 0.6rem; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 50px 12px; padding-top: 30px; } 
            .product-card { padding: 15px; border-radius: 20px; }
            .mobile-brand-identity { display: flex; }
            .topping-grid { grid-template-columns: 1fr; }
            .cart-float { bottom: 100px; left: 20px; right: 20px; padding: 12px 24px; }
        }
    </style>
</head>
<body>

    <!-- Layar Loading -->
    <div id="app-preloader">
        <div class="preloader-logo"><i class="fas fa-gem"></i></div>
        <div class="preloader-text">NYEZ.ID</div>
        <div class="loading-bar-container"><div class="loading-bar-fill"></div></div>
    </div>

    <!-- Status Koneksi -->
    <div id="sync-status">
        <i class="fas fa-cloud-bolt"></i>
        <span>MENGHUBUNGKAN...</span>
    </div>

    <div class="bg-decorations">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-logo"><i class="fas fa-gem"></i> <span>NYEZ.ID</span></div>
        <nav class="nav-group">
            <button class="nav-btn active d-nav" data-tab="menu" onclick="switchTab('menu', this)"><i class="fas fa-mug-hot"></i> <span>Daftar Menu</span></button>
            <button class="nav-btn d-nav" data-tab="tracking" onclick="switchTab('tracking', this)"><i class="fas fa-history"></i> <span>Riwayat Transaksi</span></button>
        </nav>
    </aside>

    <nav class="bottom-nav">
        <button class="mobile-nav-btn active m-nav" data-tab="menu" onclick="switchTab('menu', this)"><i class="fas fa-mug-hot"></i><span>MENU</span></button>
        <button class="mobile-nav-btn m-nav" data-tab="tracking" onclick="switchTab('tracking', this)"><i class="fas fa-history"></i><span>RIWAYAT</span></button>
    </nav>

    <main class="main-content">
        <div class="mobile-brand-identity"><div class="brand-logo-wrapper"><i class="fas fa-gem"></i></div><span>NYEZ.ID</span></div>

        <header>
            <div>
                <h2 id="page-title">Pesan Minuman</h2>
                <p id="page-subtitle">Jelajahi rasa eksklusif yang dirancang untuk harimu.</p>
            </div>
        </header>

        <!-- Tab Menu -->
        <div id="tab-menu" class="tab-content">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="menu-search" class="menu-search-input" placeholder="Cari minuman favoritmu..." onkeyup="handleSearch()">
                </div>
            </div>

            <div class="category-container" id="category-list">
                <div class="cat-card active" onclick="filterCategory('all', this)">‚ú® Semua</div>
                <div class="cat-card" onclick="filterCategory('chocolate', this)">üç´ Chocolate</div>
                <div class="cat-card" onclick="filterCategory('coffee', this)">‚òï Coffee</div>
                <div class="cat-card" onclick="filterCategory('fruit', this)">üçé Fruit</div>
                <div class="cat-card" onclick="filterCategory('classic', this)">üç™ Classic</div>
                <div class="cat-card" onclick="filterCategory('spesial', this)">üíé Spesial</div>
            </div>

            <div class="product-grid" id="product-list"></div>
        </div>

        <!-- Tab Riwayat -->
        <div id="tab-tracking" class="tab-content hidden">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-magnifying-glass"></i>
                    <input type="text" id="tracking-search" class="menu-search-input" placeholder="Cari ID pesanan..." onkeyup="handleTrackingSearch()">
                </div>
            </div>
            <div id="tracking-list" class="track-grid"></div>
        </div>
    </main>

    <!-- Floating Island Cart Button -->
    <div class="cart-float hidden" id="cart-float" onclick="openCartModal()">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="cart-badge" id="cart-count-badge">0</div>
            <div class="cart-label">
                <span>Pesanan</span>
                <span id="cart-total-price">Rp 0</span>
            </div>
        </div>
        <i class="fas fa-shopping-bag" style="font-size: 1.3rem;"></i>
    </div>

    <!-- Modal QRIS Payment -->
    <div id="qris-modal" class="modal-overlay hidden" style="z-index: 10000;">
        <div class="modal-card" style="max-width: 420px; text-align: center; padding: 0;">
            <div class="close-modal-btn" onclick="document.getElementById('qris-modal').classList.add('hidden')">
                <i class="fas fa-times"></i>
            </div>
            <div style="padding: 40px;">
                <h2 style="font-weight: 800; margin-bottom: 10px;">Scan & Bayar</h2>
                <div style="background: white; padding: 15px; border-radius: 24px; border: 2px solid var(--primary-light); display: inline-block; margin-bottom: 25px;">
                    <img id="qris-img" src="" style="width: 250px; height: 250px; object-fit: contain;">
                </div>
                <div style="background: #f5f3ff; padding: 15px; border-radius: 18px; margin-bottom: 30px;">
                    <span id="qris-total-text" style="font-weight: 900; font-size: 1.5rem; color: var(--text-main);">Rp 0</span>
                </div>
                <button onclick="finalizeOrderFromQRIS()" class="btn-confirm">Saya Sudah Bayar</button>
            </div>
        </div>
    </div>

    <!-- Modal Kustomisasi (Topping) -->
    <div id="custom-modal" class="modal-overlay hidden" onclick="closeModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="close-modal-btn" onclick="closeModal()"><i class="fas fa-times"></i></div>
            <div class="modal-body">
                <div style="display: flex; gap: 24px; margin-bottom: 32px; align-items: center;">
                    <img id="modal-img" src="" style="width: 110px; height: 110px; border-radius: 20px; object-fit: cover; box-shadow: var(--shadow-md);">
                    <div>
                        <h2 id="modal-name" style="font-weight: 900; font-size: 1.5rem; color: var(--text-main);">Nama</h2>
                        <p id="modal-base-price" style="color: var(--primary); font-weight: 900; font-size: 1.2rem;">Rp 0</p>
                    </div>
                </div>
                <span style="font-weight: 800; font-size: 1rem; color: var(--text-main);">Pilih Topping</span>
                <div class="topping-grid" id="topping-list"></div>
                <div class="qty-ctrl">
                    <button class="qty-btn" onclick="updateQty(-1)">-</button>
                    <span id="modal-qty" style="font-weight: 900; font-size: 1.6rem; min-width: 40px; text-align: center;">1</span>
                    <button class="qty-btn" onclick="updateQty(1)">+</button>
                </div>
            </div>
            <div class="modal-footer"><button class="btn-confirm" onclick="addToCart()"><span>Tambah ke Keranjang</span><span id="modal-subtotal">Rp 0</span></button></div>
        </div>
    </div>

    <!-- AESTHETIC CHECKOUT MODAL -->
    <div id="cart-modal" class="modal-overlay hidden" onclick="closeModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="close-modal-btn" onclick="closeModal()"><i class="fas fa-times"></i></div>
            <div class="modal-body">
                <h2 style="font-weight: 900; margin-bottom: 24px; font-size: 1.6rem; display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-shopping-bag" style="color: var(--primary);"></i> Pesanan Saya
                </h2>
                
                <div id="cart-items-list" style="margin-bottom: 30px; max-height: 300px; overflow-y: auto; padding-right: 5px;"></div>
                
                <div class="input-group" style="margin-bottom: 25px;">
                    <label style="display: block; font-weight: 800; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Nama Pelanggan</label>
                    <input type="text" id="customer-name" class="input-box" placeholder="Siapa nama kamu?">
                </div>

                <label style="display: block; font-weight: 800; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">Metode Pembayaran</label>
                <div class="payment-grid">
                    <div class="payment-option active" onclick="setPaymentMethod('Cash', this)">
                        <i class="fas fa-wallet"></i>
                        <span>Tunai</span>
                    </div>
                    <div class="payment-option" onclick="setPaymentMethod('QRIS', this)">
                        <i class="fas fa-qrcode"></i>
                        <span>QRIS</span>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 35px; padding-top: 20px; border-top: 1.5px dashed #e2e8f0;">
                    <span style="color: var(--text-muted); font-weight: 800; font-size: 0.9rem;">TOTAL BAYAR</span>
                    <span id="checkout-total" style="color: var(--primary); font-size: 1.8rem; font-weight: 900; letter-spacing: -1px;">Rp 0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-confirm" id="btn-order" onclick="initiateCheckoutFlow()">
                    <span>Konfirmasi Pesanan</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = "https://ypvnuopixilhafgwlukz.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlwdm51b3BpeGlsaGFmZ3dsdWt6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MjkxNTIsImV4cCI6MjA4MzMwNTE1Mn0.ZpxJfMuFD5xsYKNdqBAwLWayoJVQUYUipvVtXiVYGbI";

        let sb = null, products = [], toppings = [], cart = [], activeCategory = 'all', searchQuery = '', trackingSearchQuery = '', selectedPaymentMethod = 'Cash', currentItem = null;

        async function init() {
            try {
                sb = supabase.createClient(SB_URL, SB_KEY);
                await loadData(); setupRealtime(); checkExistingOrders();
                document.getElementById('sync-status').style.color = 'var(--success)';
                document.querySelector('#sync-status span').innerText = 'ONLINE';
                setTimeout(() => { document.getElementById('app-preloader').classList.add('fade-out'); }, 1500);
                setInterval(checkExistingOrders, 5000);
            } catch (e) { document.getElementById('app-preloader').classList.add('fade-out'); }
        }

        async function loadData() {
            if(!sb) return;
            const [pRes, tRes] = await Promise.all([
                sb.from('products').select('*').eq('is_available', true).order('name'),
                sb.from('toppings').select('*').eq('is_available', true).order('name')
            ]);
            products = pRes.data || []; toppings = tRes.data || [];
            renderProducts(); renderToppingsInModal();
        }

        function handleSearch() { searchQuery = document.getElementById('menu-search').value.toLowerCase(); renderProducts(); }
        function handleTrackingSearch() { trackingSearchQuery = document.getElementById('tracking-search').value.toLowerCase(); checkExistingOrders(); }

        function renderProducts() {
            const list = document.getElementById('product-list');
            const filtered = products.filter(p => (activeCategory === 'all' || p.category === activeCategory) && p.name.toLowerCase().includes(searchQuery));
            list.innerHTML = filtered.length === 0 ? `<p style="grid-column:1/-1; text-align:center; padding:40px; color: var(--text-muted);">Menu tidak ditemukan.</p>` : 
            filtered.map((p, index) => `
                <div class="product-card" style="animation-delay: ${index * 0.05}s" onclick="openCustomModal('${p.id}')">
                    <div class="img-container"><div class="img-accent"></div><img src="${p.image_url}" class="product-img" onerror="this.src='https://via.placeholder.com/300?text=Drink'"></div>
                    <div class="product-info"><h4>${p.name}</h4><span class="price">Rp ${p.price.toLocaleString()}</span><button class="btn-add-small">Pilih <i class="fas fa-plus"></i></button></div>
                </div>`).join('');
        }

        function renderToppingsInModal() {
            document.getElementById('topping-list').innerHTML = toppings.map(t => `
                <div class="topping-item" data-name="${t.name}" data-price="${t.price}" onclick="toggleTopping(this)">
                    <div class="top-check"><i class="fas fa-check"></i></div>
                    <span class="top-name">${t.name}</span>
                    <span class="top-price">+ Rp ${t.price.toLocaleString()}</span>
                </div>`).join('');
        }

        function openCustomModal(pid) {
            const p = products.find(x => x.id === pid);
            currentItem = { ...p, qty: 1, selectedToppings: [] };
            document.getElementById('modal-img').src = p.image_url;
            document.getElementById('modal-name').innerText = p.name;
            document.getElementById('modal-base-price').innerText = `Rp ${p.price.toLocaleString()}`;
            document.getElementById('modal-qty').innerText = "1";
            document.querySelectorAll('.topping-item').forEach(el => el.classList.remove('selected'));
            updateModalSubtotal(); document.getElementById('custom-modal').classList.remove('hidden');
        }

        function toggleTopping(el) {
            el.classList.toggle('selected');
            const tName = el.dataset.name, tPrice = parseInt(el.dataset.price);
            const idx = currentItem.selectedToppings.findIndex(x => x.name === tName);
            if(idx > -1) currentItem.selectedToppings.splice(idx, 1);
            else currentItem.selectedToppings.push({ name: tName, price: tPrice });
            updateModalSubtotal();
        }

        function updateQty(val) { currentItem.qty = Math.max(1, currentItem.qty + val); document.getElementById('modal-qty').innerText = currentItem.qty; updateModalSubtotal(); }
        function updateModalSubtotal() {
            const total = (currentItem.price + currentItem.selectedToppings.reduce((s, t) => s + t.price, 0)) * currentItem.qty;
            document.getElementById('modal-subtotal').innerText = `Rp ${total.toLocaleString()}`;
        }

        function addToCart() {
            cart.push({ id: Date.now(), pid: currentItem.id, name: currentItem.name, qty: currentItem.qty, toppings: currentItem.selectedToppings.map(t => t.name), total: parseInt(document.getElementById('modal-subtotal').innerText.replace(/\D/g,'')) });
            updateCartUI(); closeModal();
        }

        function updateCartUI() {
            const total = cart.reduce((s, i) => s + i.total, 0), count = cart.reduce((s, i) => s + i.qty, 0);
            document.getElementById('cart-float').classList.toggle('hidden', cart.length === 0);
            document.getElementById('cart-count-badge').innerText = count;
            document.getElementById('cart-total-price').innerText = `Rp ${total.toLocaleString()}`;
            document.getElementById('checkout-total').innerText = `Rp ${total.toLocaleString()}`;
        }

        function setPaymentMethod(method, el) { selectedPaymentMethod = method; document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('active')); el.classList.add('active'); }

        function initiateCheckoutFlow() {
            const name = document.getElementById('customer-name').value.trim();
            if(!name) return;
            if(cart.length === 0) return;
            if (selectedPaymentMethod === 'QRIS') {
                const totalText = document.getElementById('checkout-total').innerText;
                document.getElementById('qris-total-text').innerText = totalText;
                document.getElementById('qris-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=NYEZ-PAYMENT-${totalText.replace(/\D/g,'')}`;
                document.getElementById('cart-modal').classList.add('hidden');
                document.getElementById('qris-modal').classList.remove('hidden');
            } else { processCheckout(); }
        }

        function finalizeOrderFromQRIS() { document.getElementById('qris-modal').classList.add('hidden'); processCheckout(); }

        async function processCheckout() {
            const name = document.getElementById('customer-name').value.trim();
            const btn = document.getElementById('btn-order');
            btn.innerHTML = `<span>Memproses...</span> <i class="fas fa-spinner fa-spin"></i>`;
            btn.disabled = true;
            const payload = { order_id: "NYEZ-" + Math.floor(1000 + Math.random() * 9000), customer_name: name, items: cart, total_price: document.getElementById('checkout-total').innerText, status: 'Menunggu', payment_method: selectedPaymentMethod, created_at: new Date().toISOString() };
            const { data, error } = await sb.from('orders').insert([payload]).select();
            if(!error) {
                const stored = JSON.parse(localStorage.getItem('my_orders') || '[]');
                stored.push(data[0].id); localStorage.setItem('my_orders', JSON.stringify(stored));
                cart = []; updateCartUI(); closeModal(); await checkExistingOrders();
                switchTab('tracking');
            } else { alert("Gagal kirim. Cek Policy Supabase Anda."); }
            btn.innerHTML = `<span>Konfirmasi Pesanan</span>`; btn.disabled = false;
        }

        async function checkExistingOrders() {
            if(!sb) return;
            const stored = JSON.parse(localStorage.getItem('my_orders') || '[]');
            if(stored.length === 0) return;
            const { data } = await sb.from('orders').select('*').in('id', stored).order('created_at', { ascending: false });
            if(data) {
                const list = document.getElementById('tracking-list');
                const filtered = data.filter(o => o.customer_name.toLowerCase().includes(trackingSearchQuery) || o.order_id.toLowerCase().includes(trackingSearchQuery));
                list.innerHTML = filtered.length === 0 ? `<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: var(--text-muted);">Riwayat tidak ditemukan.</div>` : 
                filtered.map((o, idx) => `<div class="track-card" style="animation-delay: ${idx * 0.1}s"><div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:15px;"><div><span class="order-tag">#${o.order_id}</span><div style="font-weight:800;font-size:1.1rem;margin-top:8px;">${o.customer_name}</div></div><span class="badge ${o.status === 'Berhasil' ? 'badge-ready' : 'badge-pending'}">${o.status === 'Berhasil' ? 'SIAP' : o.status}</span></div><div style="font-size:0.8rem;color:var(--text-muted);padding-top:15px;border-top:1.5px dashed #f1f5f9;">${o.items.map(i => `${i.qty}x ${i.name}`).join(', ')}</div></div>`).join('');
            }
        }

        function setupRealtime() { if(!sb) return; sb.channel('user-sync').on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'orders' }, () => checkExistingOrders()).subscribe(); }
        
        function switchTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(b => {
                b.classList.remove('active');
                if(b.dataset.tab === id) b.classList.add('active');
            });
            document.getElementById('page-title').innerText = id === 'menu' ? 'Pesan Minuman' : 'Riwayat Transaksi';
        }

        function filterCategory(cat, el) {
            activeCategory = cat; document.querySelectorAll('.cat-card').forEach(p => p.classList.remove('active'));
            el.classList.add('active'); renderProducts();
        }

        function openCartModal() {
            const list = document.getElementById('cart-items-list');
            list.innerHTML = cart.length === 0 ? `<p style="text-align:center; padding:20px; color: var(--text-muted);">Keranjang kosong.</p>` :
            cart.map((item, idx) => `
                <div class="checkout-item">
                    <div>
                        <div class="checkout-item-title">${item.qty}x ${item.name}</div>
                        <div class="checkout-item-toppings">${item.toppings.join(', ') || '-'}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="checkout-item-price">Rp ${item.total.toLocaleString()}</div>
                        <i class="fas fa-trash-can" style="color:#fda4af; cursor:pointer;" onclick="removeFromCart(${idx})"></i>
                    </div>
                </div>`).join('');
            document.getElementById('cart-modal').classList.remove('hidden');
        }

        function removeFromCart(idx) { cart.splice(idx, 1); updateCartUI(); openCartModal(); }
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden')); }
        window.onload = init;
    </script>
</body>
</html>
